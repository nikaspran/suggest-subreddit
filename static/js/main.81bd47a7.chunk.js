(this["webpackJsonpsuggest-subreddit"]=this["webpackJsonpsuggest-subreddit"]||[]).push([[0],[,,,,function(e,t,n){e.exports={suggestion:"Suggestion_suggestion__V8twn",contentContainer:"Suggestion_contentContainer__1L6gZ",details:"Suggestion_details__25987",content:"Suggestion_content__2M1JU",title:"Suggestion_title__3GZHo",score:"Suggestion_score__2df-3",description:"Suggestion_description__a4vvc",controls:"Suggestion_controls__2yJhl",excludeButton:"Suggestion_excludeButton__pbK15"}},function(e,t,n){e.exports={description:"SuggestionPage_description__2pdr4",container:"SuggestionPage_container__dAmph",title:"SuggestionPage_title__1dTlJ",logoutLink:"SuggestionPage_logoutLink__1ZCkD",loadingContainer:"SuggestionPage_loadingContainer__24sJP",refreshButton:"SuggestionPage_refreshButton__1b4O_"}},,,function(e,t,n){e.exports={loginPage:"LoginPage_loginPage__3bRAY",loginContainer:"LoginPage_loginContainer__2S3VI",title:"LoginPage_title__1EvV2",disclaimer:"LoginPage_disclaimer__1K1lE",example:"LoginPage_example__2fagL"}},,,,,,function(e,t,n){e.exports={footer:"Footer_footer__1G6Wy"}},function(e,t,n){e.exports={link:"Link_link__v1uWG"}},,,,,function(e,t,n){e.exports={callToAction:"CallToAction_callToAction__1lKlF"}},function(e,t,n){e.exports={suggestion:"Suggestions_suggestion__z2rEA"}},function(e,t,n){e.exports={layout:"Layout_layout__3CwMv"}},function(e){e.exports=JSON.parse('{"nottheonion":{"score":6,"contributors":{"bestof":1,"history":1,"fitness":1,"askscience":1,"netflix":1,"announcements":1}},"reactiongifs":{"score":5,"contributors":{"bestof":1,"netflix":1,"announcements":1,"youtubehaiku":1,"accidentalrenaissance":1}},"news":{"score":4,"contributors":{"worldnews":1,"bestof":1,"history":1,"fitness":1}},"UpliftingNews":{"score":4,"contributors":{"worldnews":1,"history":1,"askscience":1,"announcements":1}},"MovieDetails":{"score":4,"contributors":{"movies":1,"netflix":1,"youtubehaiku":1,"accidentalrenaissance":1}},"SubredditDrama":{"score":4,"contributors":{"bestof":1,"truereddit":1,"announcements":1,"youtubehaiku":1}},"OutOfTheLoop":{"score":4,"contributors":{"bestof":1,"netflix":1,"announcements":1,"truegaming":1}},"IAmA":{"score":4,"contributors":{"bestof":1,"history":1,"askscience":1,"announcements":1}},"todayilearned":{"score":4,"contributors":{"bestof":1,"history":1,"fitness":1,"science":1}},"JusticeServed":{"score":4,"contributors":{"bestof":1,"netflix":1,"accidentalrenaissance":1,"cozyplaces":1}},"EverythingScience":{"score":4,"contributors":{"tech":1,"foodforthought":1,"gamernews":1,"science":1}},"space":{"score":4,"contributors":{"history":1,"askscience":1,"announcements":1,"futurology":1}},"HistoryMemes":{"score":4,"contributors":{"history":1,"mountandblade":1,"crusaderkings":1,"youtubehaiku":1}},"therewasanattempt":{"score":4,"contributors":{"programmerhumor":1,"accidentalrenaissance":1,"cozyplaces":1,"evilbuildings":1}},"business":{"score":3,"contributors":{"worldnews":1,"tech":1,"truereddit":1}},"Economics":{"score":3,"contributors":{"worldnews":1,"truereddit":1,"foodforthought":1}},"gadgets":{"score":3,"contributors":{"technology":1,"history":1,"askscience":1}},"technews":{"score":3,"contributors":{"technology":1,"tech":1,"gamernews":1}}}')},function(e,t,n){e.exports={error:"ErrorNotification_error__27kai"}},function(e,t,n){e.exports={loading:"Loading_loading__2yynj"}},function(e,t,n){e.exports=n(33)},,,,,function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(17),c=n.n(o),i=(n(31),n(1)),s=n(3),u=n.n(s),l=n(11),d=n(10),m=n(18),f=n(19),g=n(7),b={REDDIT_CLIENT_ID:"ubcs049_cdvODQ",REDDIT_REDIRECT_URI:"https://nikas.praninskas.com/suggest-subreddit/"};function p(e){return Object.entries(e).map((function(e){var t=Object(i.a)(e,2),n=t[0],r=t[1];return"".concat(n,"=").concat(window.encodeURIComponent(r))})).join("&")}function h(e,t){return Object.keys(t).length?"".concat(e,"?").concat(p(t)):e}function v(){return(v=Object(g.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",Authorization:"Basic ".concat(btoa("".concat(b.REDDIT_CLIENT_ID,":")))},body:p({grant_type:"authorization_code",code:t,redirect_uri:b.REDDIT_REDIRECT_URI})});case 2:if((n=e.sent).ok){e.next=9;break}return e.t0=Error,e.next=7,n.text();case 7:throw e.t1=e.sent,new e.t0(e.t1);case 9:return e.next=11,n.json();case 11:if(!(r=e.sent).error){e.next=14;break}throw new Error(r.error);case 14:return e.abrupt("return",Object(d.a)({},r,{expires_at:Date.now()+1e3*r.expires_in}));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=function(){function e(t){Object(m.a)(this,e),this.token=t}return Object(f.a)(e,[{key:"iterateAndCollectListing",value:function(){var e=Object(g.a)(u.a.mark((function e(t,n){var r,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(h(t,Object(d.a)({limit:100},n?{after:n}:{})),{headers:{Authorization:"bearer ".concat(this.token.access_token)}});case 2:if((r=e.sent).ok){e.next=9;break}return e.t0=Error,e.next=7,r.text();case 7:throw e.t1=e.sent,new e.t0(e.t1);case 9:return e.next=11,r.json();case 11:if(a=e.sent,e.t2=[],e.t3=Object(l.a)(a.data.children),e.t4=l.a,!a.data.after){e.next=21;break}return e.next=18,this.iterateAndCollectListing(t,a.data.after);case 18:e.t5=e.sent,e.next=22;break;case 21:e.t5=[];case 22:return e.t6=e.t5,e.t7=(0,e.t4)(e.t6),e.abrupt("return",e.t2.concat.call(e.t2,e.t3,e.t7));case 25:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fetchSubscribedSubreddits",value:function(){var e=Object(g.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.iterateAndCollectListing("https://oauth.reddit.com/subreddits/mine/subscriber"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function _(){window.location.href=h("https://www.reddit.com/api/v1/authorize",{client_id:b.REDDIT_CLIENT_ID,response_type:"code",state:"4",redirect_uri:b.REDDIT_REDIRECT_URI,duration:"temporary",scope:"mysubreddits"})}function y(){localStorage.removeItem("redditApiToken")}var w=a.a.createContext({redditApi:void 0,authError:void 0,login:_,logout:y});function x(e){var t=e.children,n=Object(r.useState)(),o=Object(i.a)(n,2),c=o[0],s=o[1],u=Object(r.useState)(),l=Object(i.a)(u,2),d=l[0],m=l[1];return Object(r.useEffect)((function(){var e=function(){var e=localStorage.getItem("redditApiToken");if(e){var t=JSON.parse(e);if(t.expires_at&&!(t.expires_at<Date.now()-6e5))return t;y()}}();if(e)s(new E(e));else{var t=window.location.search.match(/code=([^&]+)/)||[],n=Object(i.a)(t,2)[1];n&&(window.history.replaceState(null,"",window.location.pathname),function(e){return v.apply(this,arguments)}(n).then((function(e){!function(e){var t=JSON.stringify(e);localStorage.setItem("redditApiToken",t)}(e),s(new E(e))})).catch((function(){m("Could not authenticate with Reddit, please try again later")})))}}),[]),a.a.createElement(w.Provider,{value:{redditApi:c,authError:d,login:_,logout:function(){y(),s(void 0)}}},t)}function O(){return Object(r.useContext)(w)}var k=n(8),j=n.n(k),S=n(6),N=n(2),C=n.n(N),I=n(20),R=n.n(I);function T(e){var t=e.className,n=Object(S.a)(e,["className"]);return a.a.createElement("button",Object.assign({className:C()(R.a.callToAction,t)},n))}var L=n(21),P=n.n(L),A=n(4),D=n.n(A);function B(e){var t=e.children;return a.a.createElement(a.a.Fragment,null,t.reduce((function(e,n,r){return 0===r?[n]:[].concat(Object(l.a)(e),[r===t.length-1?" and ":", ",n])}),[]))}function M(){return(M=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function J(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var z=a.a.createElement("line",{x1:5,y1:5,x2:95,y2:95,strokeLinecap:"round"}),F=a.a.createElement("line",{x1:5,y1:95,x2:95,y2:5,strokeLinecap:"round"}),U=function(e){var t=e.svgRef,n=e.title,r=J(e,["svgRef","title"]);return a.a.createElement("svg",M({width:100,height:100,viewBox:"0 0 100 100",stroke:"#000",strokeWidth:"8px",ref:t},r),n?a.a.createElement("title",null,n):null,z,F)},W=a.a.forwardRef((function(e,t){return a.a.createElement(U,M({svgRef:t},e))}));n.p;function K(e){var t=e.subreddit,n=Object(S.a)(e,["subreddit"]);return a.a.createElement("a",Object.assign({href:"https://www.reddit.com/r/".concat(t),target:"_blank",rel:"noopener noreferrer"},n),"/r/",t)}function G(e){var t=e.className,n=e.subreddit,r=e.score,o=e.contributors,c=e.onExclude;return a.a.createElement("div",{className:C()(D.a.suggestion,t)},a.a.createElement("div",{className:D.a.contentContainer},a.a.createElement("div",{className:D.a.content},a.a.createElement(K,{subreddit:n,className:D.a.title}),a.a.createElement("div",{className:D.a.description},"Similar to ",a.a.createElement("strong",null,Math.round(100*Number(r.toFixed(2))),"%")," of your subreddits")),a.a.createElement("div",{className:D.a.controls},c&&a.a.createElement("button",{type:"button",className:D.a.excludeButton,title:"Exclude subreddit",onClick:c},a.a.createElement(W,null)))),a.a.createElement("div",{className:D.a.details},"Because you subscribe to"," ",a.a.createElement(B,null,Object.keys(o).map((function(e){return a.a.createElement(K,{subreddit:e,key:e})})))))}function H(e){var t=e.className,n=e.data,r=e.totalSubreddits,o=e.onExclude;return a.a.createElement("div",{className:t},Object.entries(n).map((function(e){var t=Object(i.a)(e,2),n=t[0],c=t[1];return a.a.createElement(G,{key:n,subreddit:n,score:c.score/r,contributors:c.contributors,className:P.a.suggestion,onExclude:o&&function(){return o(n)}})})))}var V=n(22),Z=n.n(V);function q(e){var t=e.className,n=e.children;return a.a.createElement("div",{className:C()(Z.a.layout,t)},n)}var Q=n(23),Y=n(14),$=n.n(Y),X=n(15),ee=n.n(X);function te(e){var t=e.className,n=e.element,r=void 0===n?"a":n,o=Object(S.a)(e,["className","element"]);return"a"===r?a.a.createElement("a",Object.assign({className:C()(ee.a.link,t),rel:"noopener noreferrer",target:"blank"},o)):a.a.createElement("button",Object.assign({className:C()(ee.a.link,t)},o))}function ne(){return a.a.createElement("footer",{className:$.a.footer},a.a.createElement(te,{href:"https://github.com/nikaspran/suggest-subreddit"},"GitHub"),a.a.createElement(te,{href:"https://twitter.com/nikaspran",className:$.a.twitterLink},"@nikaspran"))}function re(){return a.a.createElement("div",{style:{flex:"1 1 auto"}})}var ae=n(24),oe=n.n(ae);function ce(e){var t=e.title,n=e.children,r=e.className;return a.a.createElement("div",{className:C()(oe.a.error,r)},t&&a.a.createElement("strong",null,t),a.a.createElement("p",null,n))}function ie(){var e=O(),t=e.login,n=e.authError;return a.a.createElement(q,{className:j.a.loginPage},a.a.createElement("div",{className:j.a.loginContainer},a.a.createElement(re,null),a.a.createElement("h1",{className:j.a.title},"Suggest me a subreddit"),a.a.createElement(T,{type:"button",onClick:t},"Fetch my subreddits via Reddit"),a.a.createElement("p",{className:j.a.disclaimer},"All data stays in your browser only"),n&&a.a.createElement(ce,{title:"Could not authenticate with Reddit"},"The request might have been blocked due to tracking protection"," - ","you can try disabling blockers or try again later"),a.a.createElement(re,null),a.a.createElement(ne,null)),a.a.createElement("div",{className:j.a.example},a.a.createElement(H,{data:Q,totalSubreddits:34})))}var se,ue=n(13),le=n(5),de=n.n(le);function me(){return new Worker("".concat("/suggest-subreddit","/similarSubreddits.worker.js"))}function fe(){return(fe=Object(g.a)(u.a.mark((function e(t){var n,r,a,o,c,i=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=n.count,a=void 0===r?20:r,o=n.exclude,c=void 0===o?new Set:o,e.abrupt("return",new Promise((function(e,n){se=se||me();var r="invocation_".concat(Math.random());se.postMessage({invocationKey:r,sourceSubreddits:t,exclude:c,count:a});var o=setTimeout((function(){se.removeEventListener("message",i),n(new Error("TIMEOUT: could not calculate similar subreddits in ".concat(10," seconds")))}),1e4);function i(t){var a=t.data;a.invocationKey===r&&(se.removeEventListener("message",i),clearTimeout(o),a.result?e(a.result):n(new Error(a.error)))}se.addEventListener("message",i)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ge=n(25),be=n.n(ge);function pe(){return(pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function he(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var ve=a.a.createElement("g",{fill:"none",fillRule:"evenodd"},a.a.createElement("g",{transform:"translate(1 1)",strokeWidth:2},a.a.createElement("circle",{strokeOpacity:.5,cx:18,cy:18,r:18}),a.a.createElement("path",{d:"M36 18c0-9.94-8.06-18-18-18"},a.a.createElement("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"1s",repeatCount:"indefinite"})))),Ee=function(e){var t=e.svgRef,n=e.title,r=he(e,["svgRef","title"]);return a.a.createElement("svg",pe({width:38,height:38,viewBox:"0 0 38 38",stroke:"#fff",ref:t},r),n?a.a.createElement("title",null,n):null,ve)},_e=a.a.forwardRef((function(e,t){return a.a.createElement(Ee,pe({svgRef:t},e))}));n.p;function ye(){return a.a.createElement(_e,{className:be.a.loading})}var we=a.a.createContext({excludedSubreddits:new Set,exclude:function(e){}});function xe(e){var t=e.children,n=Object(r.useState)(function(){var e=localStorage.getItem("excludedSubreddits");return new Set(e&&e.split(","))}()),o=Object(i.a)(n,2),c=o[0],s=o[1];return a.a.createElement(we.Provider,{value:{excludedSubreddits:c,exclude:function(e){s((function(t){var n=new Set(t);return n.add(e),localStorage.setItem("excludedSubreddits",Array.from(n.values()).join(",")),n}))}}},t)}function Oe(){var e=O(),t=e.redditApi,n=e.logout,o=Object(r.useContext)(we),c=o.excludedSubreddits,s=o.exclude,u=Object(r.useState)(),l=Object(i.a)(u,2),m=l[0],f=l[1],g=Object(r.useState)(),b=Object(i.a)(g,2),p=b[0],h=b[1],v=Object(r.useState)(),E=Object(i.a)(v,2),_=E[0],y=E[1],w=Object(r.useState)(void 0),x=Object(i.a)(w,2),k=x[0],j=x[1],S=Object(r.useState)(!1),N=Object(i.a)(S,2),C=N[0],I=N[1],R=Object(r.useMemo)((function(){return function(){t&&(j("Fetching your subreddits (1/2)..."),t.fetchSubscribedSubreddits().catch((function(){return Promise.reject(new Error("Could not fetch your subreddits, please refresh the page or try again later"))})).then((function(e){return y(e),j("Calculating similar subreddits (2/2)..."),function(e){return fe.apply(this,arguments)}(e.map((function(e){return e.data.display_name.toLowerCase()})),{count:20,exclude:c}).catch((function(){return Promise.reject(new Error("Could not calculate similar subreddits, please refresh the page or try again later"))}))})).then(h).then((function(){j(void 0)})).catch((function(e){f(e.message)})))}}),[t,c]);return Object(r.useEffect)((function(){p||R()}),[p,R]),a.a.createElement(q,{className:de.a.container},!k&&p?a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:de.a.description},a.a.createElement(re,null),a.a.createElement("h1",{className:de.a.title},"Suggest me a subreddit"),a.a.createElement(te,{element:"button",onClick:n,className:de.a.logoutLink},"Logout"),a.a.createElement(re,null),a.a.createElement(ne,null)),a.a.createElement("div",null,C&&a.a.createElement(te,{element:"button",onClick:R,className:de.a.refreshButton},"Refresh"),a.a.createElement(H,{data:p,className:de.a.suggestions,totalSubreddits:(null===_||void 0===_?void 0:_.length)||0,onExclude:function(e){I(!0),h((function(t){return n=t||{},r=e,Object.keys(n).reduce((function(e,t){return t===r?e:Object(d.a)({},e,Object(ue.a)({},t,n[t]))}),{});var n,r})),s(e)}}))):a.a.createElement("div",{className:de.a.loadingContainer},a.a.createElement("div",null,k),!m&&a.a.createElement(ye,null),m&&a.a.createElement(ce,{title:"An error has occurred",className:de.a.error},m)))}function ke(){return O().redditApi?a.a.createElement(Oe,null):a.a.createElement(ie,null)}var je=function(){return a.a.createElement(x,null,a.a.createElement(xe,null,a.a.createElement(ke,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(je,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[26,1,2]]]);
//# sourceMappingURL=main.81bd47a7.chunk.js.map